<!DOCTYPE HTML>
<html>
	<head>
		<title>CASTER 0.0.0</title>
		<script>
			var ws = new WebSocket('ws://'+document.location.host);
			var populate = function(crtr){
		         tabBody=document.getElementById("creatures");
		         row=document.createElement("TR");
		         cell_id = document.createElement("TD");
		         cell_cls = document.createElement("TD");
		         cell_name = document.createElement("TD");
		         cell_use = document.createElement("BUTTON");
		         cell_use.innerText = "JOIN";
		         cell_use.onclick = function(){
		         	ws.send(JSON.stringify(
		         		{"what":"join",
		         		 "crid":crtr.id
		         		}
		         ));
		         }
		         textnode_id=document.createTextNode(crtr.id);
		         textnode_cls=document.createTextNode(crtr.cls);
		         textnode_name=document.createTextNode(crtr.name);
		         cell_id.appendChild(textnode_id);
		         cell_cls.appendChild(textnode_cls);
		         cell_name.appendChild(textnode_name);
		         row.appendChild(cell_id);
		         row.appendChild(cell_cls);
		         row.appendChild(cell_name);
		         row.appendChild(cell_use);
		         tabBody.appendChild(row);
			}
			ws.onmessage = function(message) {
				document.getElementsByName('output')[0].value += message.data+'\n';
				var obj = JSON.parse(message.data)
				if (obj.what == "login"){
					for(var i = 0; i<obj.creatures.length; i++ ){
						populate(obj.creatures[i]);
					}
				}
			};
			ws.onclose = function(){
				document.getElementsByName('output')[0].value += "DISCONNECTED\n";
			}
			function do_login(form)
			{
				f = document.getElementsByName('login_form')[0]
				ws.send(JSON.stringify({what:"login", 
				                        login:f.login.value,
				                        passw:f.passw.value}))
				return false;
			}
		</script>
	</head>
	<body>
		
	<form name="login_form" method="post" onsubmit="return do_login(this);">
		<table>
			<tr>
				<td><label for="login">Login</label></td>
				<td><input type="text" name="login" value="demoth" id="login"/></td>
			</tr>
			<tr>
				<td><label for="passw">Pass</label></td>
				<td><input type="text" name="passw" value="asdf" id="passw"/></td>
			</tr>
			<tr><td><input type="submit" name="submit" value="Вход" id="submit" /></td></tr>
		</table>
	</form>
	
	<table id="creatures" style="border: solid 1px grey;">
		<tr><th>ID</th><th>Class</th><th>Name</th><th>Use</th></tr>
	</table>
	
	<textarea name="output" rows="15" cols="80">
	</textarea>
	
	</body>
</html>